<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Worlds</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        iframe { width: 100%; height: 100vh; border: none; display: block; }
    </style>
</head>
<body>
    <iframe id="adaloFrame" allowfullscreen></iframe>
    <script>
        const baseAdaloURL = "https://previewer.adalo.com/9a617ecf-1f98-45a1-a2c1-657fc4b4922e";

        function getUserId() {
            const fragId = window.location.hash ? window.location.hash.replace(/^#/, '') : null;
            const params = new URLSearchParams(window.location.search);
            const queryId = params.get("userid");
            let tgId = null;
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
                tgId = window.Telegram.WebApp.initDataUnsafe.user.id;
            }
            return fragId || queryId || tgId;
        }
        const userid = getUserId();

        // Initially load the base URL
        document.getElementById("adaloFrame").src = baseAdaloURL;

        // After 4 seconds, update the iframe src to include the #userid if available
        setTimeout(() => {
            if (userid) {
                const frame = document.getElementById("adaloFrame");
                // Only update if the #userid is not yet present
                if (!frame.src.endsWith("#" + userid)) {
                    frame.src = baseAdaloURL + "#" + userid;
                }
            }
        }, 10000);

        // If you want to check and fix the hash every time user navigates, observe iframe src changes.
        const frame = document.getElementById("adaloFrame");
        const observer = new MutationObserver(() => {
            // Only set after 4 seconds, so ignore changes within first 4 seconds.
            // If someone manually clears the hash, after 4s this will fix it.
            setTimeout(() => {
                if (userid && !frame.src.endsWith("#" + userid)) {
                    frame.src = baseAdaloURL + "#" + userid;
                }
            }, 10000);
        });
        observer.observe(frame, { attributes: true, attributeFilter: ['src'] });
    </script>
</body>
</html>
